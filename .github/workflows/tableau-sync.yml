name: Tableau Sync

on:
  schedule:
    # Runs every hour at minute 0 (adjust as needed)
    - cron: '*/10 * * * *'
  workflow_dispatch:  # Allows manual trigger from GitHub UI

jobs:
  sync:
    runs-on: ubuntu-22.04
    concurrency:
      group: tableau-sync
      cancel-in-progress: true
    timeout-minutes: 10  # Adjust based on how long your sync takes
    
    steps:
      - name: Trigger Tableau Sync
        id: sync
        run: |
          curl -X POST \
            -H "Content-Type: application/json" \
            -H "X-API-Key: ${{ secrets.TABLEAU_SYNC_API_KEY }}" \
            -H "Accept: application/x-ndjson" \
            --max-time 600 \
            "https://buyerlink-connect.floot.app/_api/tableau-raw-data/process"
# Re-register
